# RealTimeDataMonitorDemo â€” å®æ—¶é¥æµ‹æ•°æ®ç›‘æ§ç¤ºä¾‹ (gRPC + FastAPI + Redis + Docker Compose)

## 1. åœºæ™¯ä¸ç›®æ ‡
é¢å‘ç‰©è”ç½‘/ç½‘ç»œæ¢é’ˆç­‰é«˜é¢‘æ•°æ®æºï¼Œ**å®æ—¶** æ”¶é›†åŸå§‹æ•°æ®åŒ… â†’ è§£æä¸è®¡æ•° â†’ HTTP/JSON æš´éœ²æŒ‡æ ‡ã€‚

* å•æœºå³å¯ä½“éªŒå®Œæ•´é“¾è·¯ï¼›æ”¹ç”¨ Kubernetes äº¦æ˜“æ‰©å±•ã€‚
* ä»£ç ç©¿æ’å¤§é‡ä¸­æ–‡æ³¨é‡Šï¼Œé€‚åˆä½œä¸º"å­¦ä¹ å¤§å‚åç«¯æ¶æ„"ç¤ºä¾‹ã€‚ 

## 2. æ€»ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      gRPC Stream        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Redis PING/HGETALL  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  send_once   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚  ingest.py   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Redis  ğŸ³  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  (gRPC)      â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP /metrics       â”‚              â”‚   asyncio Queue
â”‚  å‰ç«¯ / curl  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  main.py     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  (FastAPI)   â”‚   pipeline.aggregator
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
* **gRPC** `TelemetryIngest.StreamPackets` æµå¼æ¥æ”¶ `Packet`ã€‚
* **asyncio.Queue** è§£è€¦æ¥æ”¶ä¸å¤„ç†ï¼Œå†…å­˜è®¡æ•°åŒæ­¥å†™å…¥ **Redis** å“ˆå¸Œ `device_metrics`ã€‚
* **FastAPI** `/metrics` ç«¯ç‚¹å®æ—¶è¯»å– Redis å¹¶è¿”å› JSONã€‚
* æ‰€æœ‰ç»„ä»¶ä»¥ **docker-compose** ä¸€é”®ç¼–æ’ï¼š`redis` ä¸ `realtime-demo` ä¸¤æœåŠ¡ã€‚

## 3. æŠ€æœ¯è¦ç‚¹
| é¢†åŸŸ | é€‰å‹ | äº®ç‚¹ |
|------|------|------|
| ä¼ è¾“åè®® | gRPC + Protobuf | åŒå‘æµã€è·¨è¯­è¨€ã€ä½å¼€é”€ |
| Web API | FastAPI + Uvicorn | åŸç”Ÿ `async`ï¼Œè‡ªåŠ¨ Swagger æ–‡æ¡£ |
| çŠ¶æ€åŒæ­¥ | Redis å“ˆå¸Œ | `HINCRBY` O(1) è®¡æ•°ï¼›å®¹å™¨æ³¨å…¥ `REDIS_HOST` å®ç° 12-Factor é…ç½® |
| å¹¶å‘æ¨¡å‹ | Python `asyncio` | å•çº¿ç¨‹å¹¶å‘ >1e4 QPSï¼›é˜Ÿåˆ—é™æµé˜² OOM |
| éƒ¨ç½² | Docker Compose | ä¸€æ¡å‘½ä»¤å®Œæˆæ„å»º/å¯åŠ¨ï¼›æ”¯æŒ Docker Desktop |

## 4. å®ç°éš¾ç‚¹ & è§£å†³æ€è·¯
1. **æ¨¡å—å¯¼å…¥å†²çª**  
   â€‘ gRPC ç”Ÿæˆæ–‡ä»¶é»˜è®¤ `import telemetry_pb2`ã€‚åœ¨åŒ…å†…ä½¿ç”¨éœ€æ”¹ä¸º `from . import telemetry_pb2`ï¼Œæ„å»ºé˜¶æ®µç”¨ `sed` è‡ªåŠ¨æ›¿æ¢ã€‚

2. **Redis è¿æ¥ in-container ä¸ localhost å·®å¼‚**  
   â€‘ é€šè¿‡ `os.getenv('REDIS_HOST', 'localhost')` è¯»å–å¹¶åœ¨ compose ä¸­æ³¨å…¥ `REDIS_HOST=redis`ï¼Œå³æœ¬åœ°ä¸å®¹å™¨ç¯å¢ƒå‡å¯è·‘ã€‚

3. **å®¹å™¨å†·å¯åŠ¨é¡ºåº**  
   â€‘ `depends_on:` ç¡®ä¿ Redis å…ˆèµ·ï¼›`ingest.py` å†…éƒ¨è¿æ¥å¤±è´¥ä¹Ÿä¼šé‡è¯•ï¼ˆå¯æ‰©å±•ï¼‰ã€‚

4. **é«˜å¹¶å‘å†…å­˜å‹åŠ›**  
   â€‘ `asyncio.Queue(maxsize=10_000)` + å®¢æˆ·ç«¯èƒŒå‹ï¼›ç”Ÿäº§ç¯å¢ƒå¯æ¢ Kafka / Redis Streamã€‚

## 5. ç›®å½•ç»“æ„ (å…³é”®æ–‡ä»¶)
```
RealTimeDataMonitorDemo/
â”œâ”€ app/
â”‚  â”œâ”€ ingest.py           # gRPC æœåŠ¡
â”‚  â”œâ”€ main.py             # FastAPI æœåŠ¡
â”‚  â”œâ”€ pipeline.py         # é˜Ÿåˆ— & èšåˆ
â”‚  â””â”€ telemetry_pb2*.py   # gRPC ç”Ÿæˆä»£ç ï¼ˆè‡ªåŠ¨ï¼‰
â”œâ”€ proto/telemetry.proto  # Protobuf å®šä¹‰
â”œâ”€ send_once.py           # éšæœºæ•°æ®åŒ…ç”Ÿæˆå™¨
â”œâ”€ docker-compose.yml     # redis + demo ä¸€é”®ç¼–æ’
â”œâ”€ Dockerfile             # å¤šé˜¶æ®µæ„å»º
â”œâ”€ è¿è¡ŒæŒ‡å—.md            # CLI & Docker ä½¿ç”¨æ–‡æ¡£
â””â”€ ä»£ç è¯¦ç»†æ³¨é‡Šä¸å­¦ä¹ æŒ‡å¯¼.md # æ·±åº¦æ³¨é‡Š
```

> æ¬¢è¿ Star/Forkï¼Œæˆ–å°†å…¶æ‰©å±•ä¸º Kafkaã€Prometheusã€Grafana ç›‘æ§ç­‰æ›´å¤§è§„æ¨¡çš„ç”Ÿäº§çº§æ¶æ„ã€‚